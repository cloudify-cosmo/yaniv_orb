description: >
  This command validates the version of a plugin
steps:
  - run:
      name: "Pull Submodules"
      command: |
        git submodule init
        git submodule update --remote --recursive
  - run:
      name: Download pip
      command: curl "https://bootstrap.pypa.io/get-pip.py" -o "get-pip.py"
  - run:
      name: Install pip
      command: sudo python get-pip.py
  - run:
      name: Install virtualenv
      command: pip install --user virtualenv
  - run:
      name: Init virtualenv
      command: virtualenv env
  - run:
      name: install tox
      command: pip install --user pygithub pyyaml==3.10
  - run:
      name: upgrade setuptools
      command: pip install --upgrade setuptools
  - run:
      name: install local project
      command: pip install https://github.com/cloudify-incubator/cloudify-ecosystem-test/archive/latest.zip
  - attach_workspace:
      at: workspace
  - run: ecosystem-test validate-plugin-version
